This is your new task

# Overview

You will create the view for viewing a dealer here. we will just implement the views of all the sub sections (tabs).

Reference the legacy files in context/tasks/legacyFiles - you will notice that when viewing a dealer user, there are tabs on that page.

you can implement the tabs and a blank view for every tab, so that if i navigate between the tabs now, the tab contents will render, but it will be a blank tab, and only says a short description for that tab so that i can know which tab is which.

## preferred directory structure

Backoffice/DealerManagement

## route notes

This is an authenticated interface and must live inside the "auth:backoffice" middleware already applied in the backoffice.php routes file

## Who can access

### dealer guard: no
### backoffice guard:

If the following keys are set:

- showDealer: for index() function

Then we have the following tabs - notice the permission keys and implement and add that for the backoffice permissions

Overview (permission key showDealer)
Branch Management (permission key indexDealerBranches)
Branch Management (permission key indexDealerSalesPeople)
Branch Management (permission key indexDealerUsers)
Branch Management (permission key indexDealerStock)
Branch Management (permission key showNotes - note for this one there is one global controller so this permission is needed to be set once only then any note across the site can be viewed)
Branch Management (permission key showDealerNotificationHistory)
Branch Management (permission key showDealerSettings)
Branch Management (permission key showDealerBillings)
Branch Management (permission key showDealerAuditLog)

## controller

Preferred controller name: DealersController (already implemented)

## vuejs abilities list

Inside app/Http/Middleware/HandleInertiaRequests.php we set the "abilities" key inside auth => user - use this abilities to conditionally show the following link:

### vuejs navigation resources/backoffice/js/Layouts/Layout.vue

If the user has the ability on the permissions key "showDealer" then show this link otherwise not.

This link is the view icon in the dealers index.

As reference, the permissions identifiers for these sections are - ensure that i have missed nothing.

indexDealershipBranches
indexDealershipSalesPeople
indexDealershipUsers
indexDealershipStock
showDealershipNotificationHistory
showDealershipSettings
showDealershipBillings
showDealershipAuditLogs

We will now focus on branch management, sales people, dealer users.

For each of these sections we will implement the index, edit and delete.

We need to implement this for both backoffice and for a dealer when a dealer is logged in with the dealer guard.

What is important to note is that code should be re-used where possible, however keep controllers separate.

Also super important, as described in the project notes, that when creating these entites which are sub relations of dealer and/or branches, to always ensure that the dropdown options are data that belongs to the dealer.

Same applies for editing. The dealer uuid will most probably be in the route and injected into the controller, make sure that what you are editing actually belongs to the correct dealer

These security checks MUST be done in the policies, over and above and including the ability validation.

And when the session user is a dealer, in other words, logged in with the "dealer" guard, it is of the utmost importance to ensure that any dropdown options originating from the database (where applicable),
as well as the record you are editing, matches the dealer / dealer id of the dealer of the session user.

Again, this must happen in the relevant policies / form requests.

Now what is super super important, is that we need an implementation for both the backoffice session user, as well as the dealer user.

look in the seeder where we add abilities / the identifiers of the permissions, there is a rule / place for adding the dealer ability.

So these abilities should also be implemented for a user's access who is logged in with the dealer guard.

I will now discuss this dual implenentation - so implementation for backoffice user and implenetation for dealer user.

(remember a sales person belongs to a branch but it has a "through" relationship to dealer called dealer() )

# backoffice user

## route notes

- This is an authenticated interface and must live inside the "auth:backoffice" middleware already applied in the backoffice.php routes file
- the uuid of the dealer will always be in the route of these sub entities
- when editing (or dropdowns), ensure that the uuid of this sub entity belongs to the dealer in the route - and to be done in the policy

## Who can access

- these access validation should apply in the policy on serverside, however also to the relevant action buttons or icons in vuejs

### dealer guard: no
### backoffice guard and permissions:

#### dealerBranches
indexDealershipBranches (already implemented)
editDealershipBranches
deleteDealershipBranches

#### salesPeople
indexDealershipSalesPeople (already implemented)
editDealershipSalesPeople
deleteDealershipSalesPeople

#### dealershipUsers
indexDealershipUsers (already implemented)
editDealershipUsers
deleteDealershipUsers
resetDealershipUserPasswords

## navigation

make sure the sections above is linked and implemented for the relevant tabs in the dealier view interface.

## other notes

you will notice there is a resetDealershipUserPasswords permission - this is for the icon in the sales persons index view to conditionally display, also ensure that this is implemented on serverside
- for the reset password, you can reference to the system users reset password action if needed
- when a system user is created, send 2 mails. first mail is confirming that user is registered and provid a login button. second email is reset password and explain that this is a new account for that said dealership and that a password reset is required. oh, and 3rd emmail to be sent is the email confirmation and make sure that there is a route and implementation (also controller and visual - i think there is - for resetting password. yes i think there is already that password implementation to reset password. so send the 3 mails when a user is registered.

## what is needed

The following is NOT limited to what needs to be done, but serves as a minimum guideline:

- Controller
- Gate / security implementation as explained in context/project_information.txt
- vuejs files

This will be for:

Branches - implement index, create, edit, delete. It is of the utmost importance that you follow the location dependency rules discussed for dropdown options for a branch. ensure that a country, state, city, suburb can be selected.

Sales People - implement index, edit, delete

Platform Users - implement index, edit, delete, password reset from index page

In this backoffice section where you access branches / system users, for each of these entities you should implement / allow notes so that it can be notes managed from the index page. Forget about the "notes" tab for the moment. Also ensure that the showNotes permission gets enfored both on index page icon and serverside

## filters

#### branches

- look at the legacy files, i want a filter for stock type, text field search, country, state, city, suburb filter
- it is of the utmost important that the discussed relational location rules also apply here

#### sales people

- filter by branch. i dont want to re-itterate everytime but make sure that the branch options are that of data available relative to the user. this applies to branches as well. but i dont want bloated controllers, so use the relationships form dealers to populate options and when submitting / inseritng data validate in policy. applies to all these sub relations.

#### system users

- text filter using (always using) the filter text scope as discussed in the project notes.

# dealer user

## route notes

- This is an authenticated interface and must live inside the "auth:dealer" middleware - implement a wrapper and route in the backoffice.php routes file
- the uuid of the dealer will never be in the route of these sub entities, instead
- when editing (or dropdowns), ensure that the uuid of this sub entity matches the dealer of the session dealer user - because this user belongs to a dealer

## Who can access

- these access validation should apply in the policy on serverside, however also to the relevant action buttons or icons in vuejs

### backoffice guard: no
### dealer guard and permissions (these will be under the guard "dealer"":

Add the permission "assignPermissions" - we will implement the logic for this permission later

#### dealer
editDealership

#### dealerBranches
indexDealershipBranches
editDealershipBranches
deleteDealershipBranches

#### salesPeople
indexDealershipSalesPeople
editDealershipSalesPeople
deleteDealershipSalesPeople

#### dealershipUsers
indexDealershipUsers
editDealershipUsers
deleteDealershipUsers
resetDealershipUserPasswords

## other notes

- you will notice there is a resetDealershipUserPasswords permission - this is for the icon in the sales persons index view to conditionally display, also ensure that this is implemented on serverside
- ensure that a user who is logged in, can never delete themself
- for the reset password, you can reference to the system users reset password action if needed
- when a system user is created, send 2 mails. first mail is confirming that user is registered and provid a login button. second email is reset password and explain that this is a new account for that said dealership and that a password reset is required. oh, and 3rd emmail to be sent is the email confirmation and make sure that there is a route and implementation (also controller and visual - i think there is - for resetting password. yes i think there is already that password implementation to reset password. so send the 3 mails when a user is registered.
- a user can never activate / deactivate themselves

## what is needed

The following is NOT limited to what needs to be done, but serves as a minimum guideline:

- Controller
- Gate / security implementation as explained in context/project_information.txt
- vuejs files

This will be for:

(add a new main navigation item, visible only if session user guard is "dealer" - call this "Configuration")

Configuration => Edit Dealership - under this configuration item, add item "Edit Dealership" - for now only implement this as a blank page with a note of what this page is, however already apply the relevant policy permissions on both serverside and vuejs

Configuration => Branches - implement index, create, edit, delete. It is of the utmost importance that you follow the location dependency rules discussed for dropdown options for a branch. ensure that a country, state, city, suburb can be selected.

Configuration => Sales People - implement index, edit, delete

Configuration => Platform Users - implement index, edit, delete, password reset from index page

## filters

#### branches

- look at the legacy files, i want a filter for stock type, text field search, country, state, city, suburb filter
- it is of the utmost important that the discussed relational location rules also apply here

#### sales people

- filter by branch. i dont want to re-itterate everytime but make sure that the branch options are that of data available relative to the user. this applies to branches as well. but i dont want bloated controllers, so use the relationships form dealers to populate options and when submitting / inseritng data validate in policy. applies to all these sub relations.

#### system users

- text filter using (always using) the filter text scope as discussed in the project notes.

# legacy files

context/tasks/legacyFiles
